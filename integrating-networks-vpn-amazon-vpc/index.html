<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Integrating networks over VPN with Amazon VPC" /><meta name="author" content="Iván Ádám Vári" /><meta property="og:locale" content="en" /><meta name="description" content="Cost effective way of connecting your office networks with pfSense 2.1.3 to Amazon VPC over OpenVPN terminated on an EC2 instance." /><meta property="og:description" content="Cost effective way of connecting your office networks with pfSense 2.1.3 to Amazon VPC over OpenVPN terminated on an EC2 instance." /><link rel="canonical" href="https://ivanvari.com/integrating-networks-vpn-amazon-vpc/" /><meta property="og:url" content="https://ivanvari.com/integrating-networks-vpn-amazon-vpc/" /><meta property="og:site_name" content="Ivan Adam Vari" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2014-05-19T00:21:58+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Integrating networks over VPN with Amazon VPC" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Iván Ádám Vári" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Iván Ádám Vári"},"dateModified":"2014-05-19T00:21:58+02:00","datePublished":"2014-05-19T00:21:58+02:00","description":"Cost effective way of connecting your office networks with pfSense 2.1.3 to Amazon VPC over OpenVPN terminated on an EC2 instance.","headline":"Integrating networks over VPN with Amazon VPC","mainEntityOfPage":{"@type":"WebPage","@id":"https://ivanvari.com/integrating-networks-vpn-amazon-vpc/"},"url":"https://ivanvari.com/integrating-networks-vpn-amazon-vpc/"}</script><title>Integrating networks over VPN with Amazon VPC | Ivan Adam Vari</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ivan Adam Vari"><meta name="application-name" content="Ivan Adam Vari"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-GST9H3668K"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-GST9H3668K'); </script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/avatar.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ivan Adam Vari</a></div><div class="site-subtitle font-italic">A minimalist SysOps/DevOps Craftsman</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/variia" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ivan.adam.vari','ivanvari.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/profile/view?id=ADEAAAZ6wwEBp7FjAqg_m7ZK8y148UI70Cyn9n8" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Integrating networks over VPN with Amazon VPC</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Integrating networks over VPN with Amazon VPC</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/variia">Iván Ádám Vári</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1400451718" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2014-05-19 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1659 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><p><a href="https://aws.amazon.com/vpc/" target="_blank">Amazon VPC</a> has been out for some time offering full control of isolated local networking in the cloud. This means that you can have your own private subnet in the cloud, have control over what private IPs your instances are going to use, change the instance type, should your resource requirements increase and so forth.</p><p>This guide is going to be technical, intended for experienced professionals where I will be discussing options and solutions to securely integrate your onsite (private) LANs with Amazon VPC. It is based on OpenVPN client running on an instance inside VPC, connecting to my remote branch firewall running pfSense 2.1.3 and OpenVPN server. The point-to-point tunnel between the client / server is 2-way, both the client and the server expose their local networks and route traffic to the other side accordingly. But first, let’s take a look at what other option we have.</p><h2 id="amazon-vpc-vpn"><span class="mr-2">Amazon VPC VPN</span><a href="#amazon-vpc-vpn" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>This is built into VPC and utilizes IPsec which operates on OSI model layer 3 and 4. This technology has been out there for long time, considered fairly secure and supported on many hardware appliances from most well known vendors. Since it operates on lower layer of the OSI model, it’s not intended for end users such as desktop computers, mobile devices, it’s more suitable for connecting networks aka site-to-site VPN.</p><h4 id="features-and-benefits"><span class="mr-2">Features and Benefits</span><a href="#features-and-benefits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><ol><li>Secure. In fact, it was not affected by the recently discovered <a href="http://heartbleed.com" target="_blank">Heartbleed</a> bug of OpenSSL as it’s using crypto built into the kernel.<li>Supports dynamic route management with iBGP, suitable for corporate networks with lots of local LANs.<li>Somewhat easy to implement, widely supported on many hardware platforms, appliances as well as open source software such as <a href="https://www.openswan.org" target="_blank">Openswan</a> or <a href="https://www.strongswan.org" target="_blank">strongSwan</a>.<li><a href="https://aws.amazon.com/vpc/pricing/" target="_blank">Cheap</a>. Currently it’s approximately ~$1 / per day depending on region.<li>It’s really the easiest, simplest, out of box solution at this time of writing.</ol><p>There is a few good guides out there to get you started, however the easiest and most up-to-date is on <a href="https://docs.openvpn.net/how-to-tutorialsguides/administration/extending-vpn-connectivity-to-amazon-aws-vpc-using-aws-vpc-vpn-gateway-service" target="_blank">OpenVPN’s website</a>.</p><h2 id="vpn-terminated-on-an-ec2-instance-inside-your-vpc"><span class="mr-2">VPN terminated on an EC2 Instance inside your VPC</span><a href="#vpn-terminated-on-an-ec2-instance-inside-your-vpc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>While it does share some features with IPsec, there are a couple of special ones that apply to OpenVPN:</p><ul><li>Cost savings. Yes, $1 a day is cheap and I have a supported hardware at my branch endpoint, BUT I already have a requirement to run an instance 24/7 inside my VPC doing DNS, NTP, git, etc. Adding a VPN and routing functionality on top of those are not hard and just makes sense. I would rather spend that $1 / day on other great services such as S3 storage or CloudWatch.<li>Internet availability inside VPC. While the IPsec VPN is superb, it does not provide you internet for your VPC resources, VPC meant to be private, no public traffic in / out. So if I have to have an instance doing SNAT for outgoing Internet inside the VPC, then why not terminate the VPN on the same instance?</ul><h4 id="build-your-vpc"><span class="mr-2">Build your VPC</span><a href="#build-your-vpc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p><img data-src="/assets/img/2014-05/24F4919D-CEFE-48D3-A811-D6BBDC7D2CF9.png" alt="Diagram" data-proofer-ignore></p><p>I will not going into too much detail here, just share the important bits I encountered during my setup. The Amazon guide is well written, please read it for full understanding of the <a href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/VPC_Scenario2.html" target="_blank">concept</a>.</p><ul><li>Create a VPC with a preferably /16 mask. eg: <code class="language-plaintext highlighter-rouge">10.0.0.0/16</code> (Note: CIDR mask must be between /16 and /28)<li>Create at least 2 subnets that overlap with your the VPC CIDR mask, preferably /24. eg: <code class="language-plaintext highlighter-rouge">10.0.0.0/24</code>, <code class="language-plaintext highlighter-rouge">10.0.1.0/24</code>. One will be your private LAN with outgoing only Internet, the other public with in and outgoing Internet.<li>Create a VPC “Internet Gateway”, attach it to your VPC.<li>Ignore “Network ACL” for now, defaults are fine.</ul><p>Pick a private IP address from your public /24 subnet you created in your VPC. eg: <code class="language-plaintext highlighter-rouge">10.0.0.8</code> This will be the internal address for your EC2 router. <em>While you cannot use static private IP addresses inside VPC at this time of writing, you can associate certain addresses to instances. They still use DHCP but always get the same address, most likely via MAC address mapping.</em></p><ul><li>Associate an “Elastic IP Address” aka public IP for your VPC if you have no free available. Use “network interface” association since we have no instance running yet, and use the private IP you picked above. This essentially creates a “network interface” object and adds your selected public / private IPs to it.<li>Create a DHCP option set (optional) if you want to dish out your own DNS servers, domain names, etc. for your VPC instances, but it’s not required for the VPN routing.<li>Make sure the security group attached to your VPC has port 22 open for 0.0.0.0/0. This is important initially for being able to reach your newly created “router” instance via the public elastic IP until you sort out the internal routing, firewalling, VPN, etc.<li>You will have a default “route” object attached to your VPC, and it will be set to “Main”. I recommend to leave that untouched which routes only it’s own VPC traffic by default. It’s important for security reasons because “Main” always applies to a subnets that are not associated with any custom “route” object.</ul><p>Then, create a custom “route” object, associate that with your “public” VPC subnet where the VPN instance resides. eg: <code class="language-plaintext highlighter-rouge">10.0.0.0/24</code>. and add your default route to it:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>0.0.0.0/0          igw-yourid
</pre></table></code></div></div><p>This essentially gives you internet access for outgoing traffic.</p><blockquote class="prompt-info"><div><p>Networks available inside your VPN EC2 instance (aka networks on the far side of your OpenVPN tunnel) will not be available for any other other instance you launch into this “public” subnet of your VPC. If you need to reach any of those by their internal VPC IP, you will have to add them to the custom “route” object you associated with the “public” subnet as follows</p></div></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>192.168.0.0/24         eni-ID
10.100.100.0/24        eni-ID
10.100.200.0/24        eni-ID
10.100.300.0/24        eni-ID
</pre></table></code></div></div><p>The ID is the “network interface” object you mapped your elastic IP to (attached to your VPN instance). The private class C address is my OpenVPN client network, the other 3 are the LANs behind the pfSense VPN server. You also have to remember, that all instances MUST have elastic IP associated to them inside your “public” VPC subnet, they will not be able to use the VPN router instance!</p><p>Create another custom “route” object, associate it with your “private” VPC subnet eg: <code class="language-plaintext highlighter-rouge">10.0.1.0/24</code> and add the following route to it:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>0.0.0.0/0          eni-ID
</pre></table></code></div></div><p>This will add default route to all instances for your “private” VPC subnet via the router EC2 instance. This “route” object can be then associated with any other “private” subnet you may create later on and required to support outgoing Internet access.</p><p>To be able to route any private subnet via your router EC2 instance, you MUST disable source and destination check on the associated network interface object.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>aws <span class="nt">--region</span> eu-central-1 ec2 modify-network-interface-attribute <span class="nt">--network-interface-id</span> <span class="s2">"eni-12f235ec"</span> <span class="nt">--no-source-dest-check</span>
</pre></table></code></div></div><h4 id="prepare-the-openvpn-server-on-pfsense"><span class="mr-2">Prepare the OpenVPN Server on pfSense</span><a href="#prepare-the-openvpn-server-on-pfsense" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><p>You will need to create a <code class="language-plaintext highlighter-rouge">ccd</code> entry for your VPC EC2 instance to ensure, that the client always gets the same tunnel IP from the server, as well as for the ability to be able to publish the remote networks on the client side to the server. It’s very simple with the web-ui of pfSense, hence I just show the relevant config entry here, should you need to set this on console:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>ifconfig-push 192.168.0.254 192.168.0.253
iroute 10.0.0.0 255.255.255.0
iroute 10.0.1.0 255.255.255.0
</pre></table></code></div></div><p>These routes however required to be added to the relevant server config too (if your run multiple). Again, this is easy on web-ui, relevant config entries are:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>route 10.0.0.0 255.255.255.0
route 10.0.1.0 255.255.255.0
push "route 10.100.100.0 255.255.255.0"
push "route 10.100.200.0 255.255.255.0"
push "route 10.100.300.0 255.255.255.0"
push "route 10.0.0.0 255.255.255.0"
push "route 10.0.1.0 255.255.255.0"
</pre></table></code></div></div><p>Why the redundant route and iroute statements, you might ask? The reason is that route controls the routing from the kernel to the OpenVPN server (via the TUN interface) while iroute controls the routing from the OpenVPN server to the remote clients.</p><p>And finally, the push-route lines add networks to all VPN clients for all networks available on both side of the tunnel between pfSense and VPC. The reason for this is that when I connect to the pfSense VPN server with my laptop, I want routes set for both, the office and the VPC networks so I can reach everything while away.</p><h2 id="launch-the-router-instance"><span class="mr-2">Launch the Router Instance</span><a href="#launch-the-router-instance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>The only thing you need to pay attention to:</p><ul><li>Ensure that you launch the instance to the correct “public” subnet of your VPC<li>Ensure you set the instance to use the prepared “network interface” object</ul><p>Once running, you should be able to reach it via SSH protocol over its public address. Depending on your distro of choice, you may need to turn on routing if not enabled by default in the kernel:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>sysctl <span class="nt">-w</span> net.ipv4.ip_forward<span class="o">=</span>1
</pre></table></code></div></div><p>OR</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo </span>1 <span class="o">&gt;</span> /proc/sys/net/ipv4/ip_forward
</pre></table></code></div></div><p>Install then configure your OpenVPN client, set it to run at boot, start, etc. Note: there is nothing specific you need to configure as long as you run client here. Add a couple of iptables rules to NAT traffic coming from your VPC destined to the Internet:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>iptables <span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 10.0.0.0/16 <span class="nt">-d</span> 10.0.0.0/16 -m comment <span class="nt">--comment</span> <span class="s2">"VPC-&gt;VPC:SKIP"</span> <span class="nt">-j</span> ACCEPT
<span class="nv">$ </span>iptables <span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 10.0.0.0/16 <span class="nt">-d</span> 10.100.0.0/16 <span class="nt">-m</span> comment <span class="nt">--comment</span> <span class="s2">"AWS-&gt;REMOTE SUBNETS:SKIP"</span> <span class="nt">-j</span> ACCEPT
<span class="nv">$ </span>iptables <span class="nt">-A</span> POSTROUTING <span class="nt">-o</span> eth0 <span class="nt">-s</span> 10.0.1.0/24 <span class="nt">-m</span> comment <span class="nt">--comment</span> <span class="s2">"SUBNET-PRIVATE-&gt;INTERNET:MASQ"</span> <span class="nt">-j</span> SNAT <span class="nt">--to-source</span> 10.0.0.8
</pre></table></code></div></div><p>We need the ACCEPT rules to avoid rewriting traffic between VPC subnets as well as between VPC and remote subnets, otherwise they have no affect. Make sure you save the rules and enable firewall service to run during boot. Note: this config assumes you have NO other firewall rules configured, those should be added when you have working routing.</p><p>You should be able to reach your instance after all this via it’s private address. When you have a working setup, remove the SSH entry from the “security group” of your VPC for additional safety.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/aws/'>AWS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/cloud/" class="post-tag no-text-decoration" >cloud</a> <a href="/tags/vpc/" class="post-tag no-text-decoration" >vpc</a> <a href="/tags/ec2/" class="post-tag no-text-decoration" >ec2</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Integrating networks over VPN with Amazon VPC - Ivan Adam Vari&amp;url=https://ivanvari.com/integrating-networks-vpn-amazon-vpc/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Integrating networks over VPN with Amazon VPC - Ivan Adam Vari&amp;u=https://ivanvari.com/integrating-networks-vpn-amazon-vpc/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://ivanvari.com/integrating-networks-vpn-amazon-vpc/&amp;text=Integrating networks over VPN with Amazon VPC - Ivan Adam Vari" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://ivanvari.com/integrating-networks-vpn-amazon-vpc/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cluster/">cluster</a> <a class="post-tag" href="/tags/couchbase/">couchbase</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/nosql/">nosql</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/cfn/">cfn</a> <a class="post-tag" href="/tags/cloudformation/">cloudformation</a> <a class="post-tag" href="/tags/hardware/">hardware</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/aws-eks-stackset-cluster-access-recovery/"><div class="card-body"> <em class="timeago small" data-ts="1565958214" > 2019-08-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS EKS StackSet created cluster access recovery</h3><div class="text-muted small"><p> Kubernetes is contagious and nowadays hard to ignore. So we decided to look into EKS to see how it would work for our microservice suite. As of today, there are 2 ways of creating (official) an EKS...</p></div></div></a></div><div class="card"> <a href="/aws-codepipeline-stuck-at-cloudformation-prepare-stage/"><div class="card-body"> <em class="timeago small" data-ts="1654426722" > 2022-06-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS Codepipeline Stuck at Cloudformation Prepare Stage</h3><div class="text-muted small"><p> This issue puzzled me and even AWS support for weeks, although for the later it was mostly because of their availability not their skills: I pushed in an update for one of my pipeline managed s...</p></div></div></a></div><div class="card"> <a href="/aws-console-mfa-1password-otp-automation/"><div class="card-body"> <em class="timeago small" data-ts="1565817497" > 2019-08-14 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS MFA enabled console with automated one time password</h3><div class="text-muted small"><p> Moving to AWS is challenging and fun at the same time. Since our migration progresses well, we have enabled enforced MFA for IAM accounts, that have Administrator access. With 1Password OTP, it is...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/couchbase-quota-explained/" class="btn btn-outline-primary" prompt="Older"><p>Couchbase Quota Explained</p></a> <a href="/script-clone-saltstack-formulas-github/" class="btn btn-outline-primary" prompt="Newer"><p>Script to Clone SaltStack Formulas from GitHub</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://ivanvari.com/integrating-networks-vpn-amazon-vpc/'; this.page.identifier = '/integrating-networks-vpn-amazon-vpc/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://ivanvari-com.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/variia">Iván Ádám Vári</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cluster/">cluster</a> <a class="post-tag" href="/tags/couchbase/">couchbase</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/nosql/">nosql</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/cfn/">cfn</a> <a class="post-tag" href="/tags/cloudformation/">cloudformation</a> <a class="post-tag" href="/tags/hardware/">hardware</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-84719456-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-84719456-1'); }); </script>
